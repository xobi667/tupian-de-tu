# Xobi 实时预览功能 - 快速启动指南

## 5 分钟快速体验

### 前置条件
- Python 3.8+
- 已配置云雾 API 密钥
- 准备好测试图片（参考图和产品图）

### 启动步骤

#### 1. 启动后端服务
```bash
# 进入项目目录
cd C:\Users\zhouk\Desktop\tupian-de-tu

# 启动 FastAPI 服务
uvicorn backend.app.main:app --reload --host 0.0.0.0 --port 8000
```

等待看到：
```
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000
```

#### 2. 访问前端界面
在浏览器中打开：
```
http://localhost:8000/single.html
```

#### 3. 测试预览功能

##### 步骤 A：上传图片
1. 点击"参考主图"区域，上传一张参考风格图
2. 点击"我的产品"区域，上传一张白底产品图
3. 看到两张图片成功显示

##### 步骤 B：与 AI 对话
在右侧聊天框输入（示例）：
```
无线耳机，主动降噪，适合地铁通勤使用
```

按 Enter 发送。

##### 步骤 C：查看 AI 建议
AI 会返回类似：
```
好的，为您策划了三个视觉方案：
[建议1: 金属拉丝背景，极简冷淡风]
[建议2: 晨曦暖阳透过百叶窗，温馨感]
[建议3: 动态水花飞溅，夏日清凉视觉]
```

##### 步骤 D：自动预览生成
- 等待 5-10 秒
- 系统会自动显示"正在为您生成预览图..."
- 预览图会在聊天中显示，带有 "PREVIEW" 水印

##### 步骤 E：查看预览效果
预览图会显示：
- 低分辨率预览（512x512）
- "PREVIEW" 水印
- 两个操作按钮：
  - 🔄 重新预览
  - ✅ 应用此预览（生成高清图）

##### 步骤 F：尝试不同建议
点击其他建议卡片（建议2 或 建议3），系统会：
1. 发送选中的建议
2. 自动生成新的预览图
3. 显示在聊天中

##### 步骤 G：应用预览
如果满意某个预览效果，点击"✅ 应用此预览（生成高清图）"：
- 系统会生成完整的高清图
- 显示在左侧的"生成结果"区域
- 可以下载保存

## 手动触发预览

### 方式 1：使用工具栏按钮
1. 在聊天输入框输入描述
2. 点击输入框上方的 🔍 按钮
3. 直接生成预览（不发送消息）

### 方式 2：继续对话
1. 修改需求描述
2. 发送给 AI
3. 等待新的建议和预览

### 方式 3：重新预览
点击预览图下方的"🔄 重新预览"按钮，使用相同参数重新生成。

## 完整工作流程

```
┌─────────────────┐
│ 1. 上传图片     │
│   - 参考图      │
│   - 产品图      │
└────────┬────────┘
         ↓
┌─────────────────┐
│ 2. 输入需求描述 │
│ "产品 + 场景"   │
└────────┬────────┘
         ↓
┌─────────────────┐
│ 3. AI 分析      │
│ 提供 3 个建议   │
└────────┬────────┘
         ↓
┌─────────────────┐
│ 4. 自动预览     │
│ 显示预览图      │
└────────┬────────┘
         ↓
    ┌────┴────┐
    ↓         ↓
┌──────┐  ┌──────┐
│满意  │  │不满意│
└──┬───┘  └───┬──┘
   ↓          ↓
┌──────┐  ┌──────────┐
│应用  │  │尝试其他  │
│生成  │  │建议      │
│高清图│  └────┬─────┘
└──────┘       ↓
            回到步骤 4
```

## 常见问题排查

### Q1: 点击建议后没有预览
**可能原因**：
- 图片未上传完成
- API 调用超时
- 网络问题

**解决方法**：
1. 确认两张图片都已上传
2. 查看浏览器控制台是否有错误
3. 点击 🔍 手动触发预览

### Q2: 预览生成很慢
**可能原因**：
- API 负载高
- 网络延迟
- 图片分辨率过大

**解决方法**：
1. 等待 60 秒（预览超时时间）
2. 检查后端日志
3. 稍后重试

### Q3: 预览图质量不理想
**说明**：
- 预览图为 512x512 低分辨率
- 用于快速查看构图和配色
- 正式生成会使用高分辨率（1K/2K/4K）

**建议**：
- 预览主要看整体效果
- 满意后点击"应用预览"生成高清图

### Q4: 无法看到预览图
**检查清单**：
- [ ] 后端服务是否运行
- [ ] 浏览器控制台是否有错误
- [ ] 网络请求是否成功（F12 查看 Network）
- [ ] API 密钥是否配置正确

## 进阶技巧

### 技巧 1：快速对比
1. 点击建议 1 → 查看预览
2. 点击建议 2 → 查看预览
3. 点击建议 3 → 查看预览
4. 滚动聊天记录对比三个预览
5. 选择最满意的点击"应用"

### 技巧 2：自定义描述
不使用建议，而是：
1. 在输入框输入自己的描述
2. 点击 🔍 直接预览
3. 不满意修改描述
4. 再次点击 🔍

### 技巧 3：组合使用
1. 先看 AI 建议
2. 在建议基础上修改
3. 手动触发预览
4. 反复调整直到满意

## 性能建议

### 最佳实践
- 使用小尺寸图片上传（< 5MB）
- 描述尽量具体明确
- 利用预览快速迭代
- 满意后再生成高清图

### 避免
- 不要频繁点击预览（有冷却时间）
- 不要上传超大图片
- 不要同时触发多个预览

## API 测试

### 使用测试脚本
```bash
# 准备测试图片
mkdir test_images
# 将 product.png 和 reference.png 放入 test_images/

# 运行测试
python test_preview_api.py
```

### 使用 curl 测试
```bash
curl -X POST http://localhost:8000/api/preview/generate \
  -F "product_image=@test_images/product.png" \
  -F "reference_image=@test_images/reference.png" \
  -F "custom_prompt=Modern minimalist product photography"
```

## 调试模式

### 查看后端日志
```bash
# 后端会打印：
[Preview] 开始生成预览图...
[Preview] Prompt: ...
[Replacer] 正在生成新主图...
[Preview] 清理临时文件...
```

### 查看前端日志
打开浏览器控制台（F12）：
```javascript
// 会显示：
预览生成错误: ...
// 或
Preview generated successfully
```

## 下一步

### 如果预览功能正常
1. 尝试批量模式（batch.html）
2. 探索更多 AI 建议
3. 调整画质和比例参数

### 如果遇到问题
1. 查看文档：PREVIEW_FEATURE_GUIDE.md
2. 查看实现总结：PREVIEW_IMPLEMENTATION_SUMMARY.md
3. 运行测试脚本诊断问题

## 总结

实时预览功能让你能够：
- ✅ 快速查看效果（5-10秒）
- ✅ 无限次尝试（不消耗高清配额）
- ✅ 对比多个方案
- ✅ 满意后生成高清图

享受更高效的创作体验！
