<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xobi v2 Pro - AI Copilot</title>

    <!-- CSS Assets -->
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/chat.css">

    <!-- Favicon (Optional) -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚡</text></svg>">
</head>

<body>

    <div class="app-container">
        <div class="main-layout">
            <!-- Left Side: Workflow -->
            <main class="workflow-area">
                <header>
                    <div class="brand">
                        <h1>Xobi v2</h1>
                        <span class="subtitle">AI 驱动的电商图像生产引擎</span>
                    </div>
                    <div class="header-tools">
                        <button class="btn btn-secondary">Admin</button>
                    </div>
                </header>

                <!-- Navigation -->
                <nav class="nav-tabs">
                    <button class="tab-btn active" data-tab="single" onclick="switchTab('single')">🎨 单图创作</button>
                    <button class="tab-btn" data-tab="batch" onclick="switchTab('batch')">⚡ 批量工厂</button>
                </nav>

                <!-- Content: Single Mode -->
                <div id="single-tab" class="tab-content active">
                    <div class="single-mode-grid">
                        <!-- Reference -->
                        <div class="card">
                            <h3>📷 参考主图</h3>
                            <div class="upload-area" id="ref-upload">
                                <div class="placeholder-content">
                                    <div class="icon-large">🖼️</div>
                                    <div>点击上传参考风格图</div>
                                </div>
                            </div>
                            <input type="file" id="ref-input" accept="image/*" hidden>
                        </div>

                        <!-- Product -->
                        <div class="card">
                            <h3>📦 我的产品</h3>
                            <div class="upload-area" id="prod-upload">
                                <div class="placeholder-content">
                                    <div class="icon-large">🛍️</div>
                                    <div>点击上传白底产品图</div>
                                </div>
                            </div>
                            <input type="file" id="prod-input" accept="image/*" hidden>
                        </div>

                        <!-- Result -->
                        <div class="card">
                            <h3>✨ 生成结果</h3>
                            <div class="upload-area" id="single-result"
                                style="cursor: default; border-style: solid; border-color: var(--border-color);">
                                <div class="placeholder-content">
                                    <div class="icon-large">🎨</div>
                                    <div>等待生成...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Single Controls -->
                    <div class="card" style="flex-direction: row; gap: 1rem; align-items: flex-end;">
                        <div style="flex: 1;">
                            <label
                                style="display:block; margin-bottom:0.5rem; color:var(--text-secondary); font-size:0.9rem;">产品名称</label>
                            <input type="text" id="prod-name" placeholder="例如：真皮沙发">
                        </div>
                        <div style="flex: 2;">
                            <label
                                style="display:block; margin-bottom:0.5rem; color:var(--text-secondary); font-size:0.9rem;">自定义优化指令
                                (Prompt)</label>
                            <input type="text" id="custom-text" placeholder="留空则由 AI 自动分析合成">
                        </div>
                        <button class="btn btn-primary" id="single-start-btn" onclick="startSingleGen()">✨ 立即生成</button>
                        <button class="btn btn-secondary" id="single-dl-btn" onclick="downloadSingle()"
                            style="display:none;">💾
                            下载</button>
                    </div>
                </div>

                <!-- Content: Batch Mode -->
                <div id="batch-tab" class="tab-content">
                    <!-- Initial Upload State -->
                    <div id="batch-upload-card" class="card" style="text-align:center; padding: 4rem 2rem;">
                        <div class="upload-area" id="excel-upload"
                            style="max-width: 600px; margin: 0 auto; min-height: 250px;">
                            <div class="placeholder-content">
                                <div class="icon-large">📊</div>
                                <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">上传 Excel的任务列表
                                </div>
                                <div style="color: var(--text-tertiary);">支持 .xlsx, .csv 格式<br>AI 自动识别列名</div>
                            </div>
                        </div>
                        <input type="file" id="excel-input" accept=".xlsx,.xls,.csv" hidden>
                    </div>

                    <!-- Batch Workspace (Table focus) -->
                    <div id="batch-workspace" class="batch-workspace-view" style="display: none;">
                        <div class="card"
                            style="flex-direction: row; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; margin-bottom: 1.5rem;">
                            <div>
                                <span style="color: var(--text-secondary);">当前任务包含</span>
                                <strong style="color: var(--text-primary); font-size: 1.2rem; margin: 0 4px;"
                                    id="batch-count">0</strong>
                                <span style="color: var(--text-secondary);">个商品</span>
                            </div>
                            <button class="btn btn-primary" id="batch-start-btn" onclick="startBatchJob()">🚀
                                开始生产</button>
                        </div>

                        <div class="card" style="flex: 1; overflow: hidden; padding: 0;">
                            <div class="table-wrapper">
                                <table id="batch-table">
                                    <thead>
                                        <tr>
                                            <th width="80">ID</th>
                                            <th width="150">产品</th>
                                            <th>参考原图</th>
                                            <th>产品原图</th>
                                            <th>AI 生成需求</th>
                                            <th width="100">状态</th>
                                        </tr>
                                    </thead>
                                    <tbody id="batch-tbody">
                                        <!-- JS Rendered -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Global Footer / Terminal -->
                <footer>
                    <div class="terminal" id="terminal">
                        <div class="log-info">[System] Xobi v2 initialized. Ready.</div>
                    </div>
                </footer>
            </main>

            <!-- Right Side: AI Copilot -->
            <aside class="ai-copilot-sidebar">
                <div class="chat-container">
                    <div class="chat-header">
                        <div class="chat-avatar">🤖</div>
                        <div class="chat-title-group">
                            <span class="chat-title">Xobi Copilot</span>
                            <span class="chat-status">在线 · 正在为您服务</span>
                        </div>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="message ai">
                            <div class="message-bubble">
                                您好！我是您的 AI 创作助手。
                                <br><br>
                                我们可以这样合作：
                                <br>1. 上传表格后告诉我：<b>“根据表格需求修改主图”</b>
                                <br>2. 或者直接对生成结果提出修改意见（如：<b>“把背景换成雪景”</b>）
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-wrapper">
                        <div class="chat-input-toolbar">
                            <button class="tool-btn" title="上传参考图">📎</button>
                            <button class="tool-btn" title="灵感建议">💡</button>
                        </div>
                        <div class="chat-input-field">
                            <input type="text" id="chat-input" placeholder="向 AI Copilot 提问 or 下达指令...">
                            <button class="btn btn-primary btn-icon" onclick="sendChat()">
                                <span>⬆</span>
                            </button>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
        <div style="text-align: center;">
            <div class="spinner"
                style="border: 3px solid rgba(255,255,255,0.1); border-top-color: var(--accent-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; margin: 0 auto 1rem;">
            </div>
            <div id="loading-text" style="color: var(--text-secondary);">Processing...</div>
        </div>
    </div>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
    <!-- Loading overlay now handled properly in main.js -->

    <!-- JS Scripts -->
    <script src="assets/js/api.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/single.js"></script>
    <script src="assets/js/batch.js"></script>
    <script src="assets/js/chat.js"></script>
    <script>
        // Init All
        document.addEventListener('DOMContentLoaded', () => {
            initSingleMode();
            initBatchMode();
            initChat();
        });
    </script>

</body>

</html>