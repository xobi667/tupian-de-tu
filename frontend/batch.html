<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xobi v2 Pro - 批量工厂</title>

    <!-- CSS Assets -->
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/chat.css">

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚡</text></svg>">

    <!-- Config Manager -->
    <script src="assets/js/config-manager.js"></script>
</head>

<body>
    <div class="app-container">
        <div class="main-layout">
            <!-- 左侧：工作区域 -->
            <main class="workflow-area">
                <header>
                    <div class="brand">
                        <h1>⚡ 批量工厂</h1>
                        <span class="subtitle">Excel 驱动的大规模图像生产</span>
                    </div>
                    <div class="header-tools">
                        <a href="settings.html" class="btn btn-secondary" style="margin-right: 0.5rem;">⚙️ API 配置</a>
                        <a href="index.html" class="btn btn-secondary">← 返回首页</a>
                    </div>
                </header>

                <!-- Excel 上传区域 -->
                <div id="batch-upload-card" class="card" style="text-align:center; padding: 4rem 2rem;">
                    <div class="upload-area" id="excel-upload"
                        style="max-width: 600px; margin: 0 auto; min-height: 250px;">
                        <div class="placeholder-content">
                            <div class="icon-large">📊</div>
                            <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">上传 Excel 任务列表
                            </div>
                            <div style="color: var(--text-tertiary);">支持 .xlsx, .csv 格式<br>AI 自动识别列名</div>
                        </div>
                    </div>
                    <input type="file" id="excel-input" accept=".xlsx,.xls,.csv" hidden>
                </div>

                <!-- 批量工作区（上传后显示） -->
                <div id="batch-workspace" class="batch-workspace-view" style="display: none;">
                    <div class="card"
                        style="flex-direction: row; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; margin-bottom: 1.5rem;">
                        <div>
                            <span style="color: var(--text-secondary);">当前任务包含</span>
                            <strong style="color: var(--text-primary); font-size: 1.2rem; margin: 0 4px;"
                                id="batch-count">0</strong>
                            <span style="color: var(--text-secondary);">个商品</span>
                        </div>
                        <button class="btn btn-primary" id="batch-start-btn" onclick="startBatchJob()">🚀 开始生产</button>
                    </div>

                    <div class="card" style="flex: 1; overflow: hidden; padding: 0;">
                        <div class="table-wrapper">
                            <table id="batch-table">
                                <thead>
                                    <tr>
                                        <th width="80">ID</th>
                                        <th width="150">产品</th>
                                        <th>参考原图</th>
                                        <th>产品原图</th>
                                        <th>AI 生成需求</th>
                                        <th width="100">状态</th>
                                    </tr>
                                </thead>
                                <tbody id="batch-tbody">
                                    <!-- JS 动态渲染 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 日志终端 -->
                <footer>
                    <div class="terminal" id="terminal">
                        <div class="log-info">[System] 批量工厂模式已就绪。请先上传 Excel 任务表。</div>
                    </div>
                </footer>
            </main>

            <!-- 右侧：AI Copilot 聊天 -->
            <aside class="ai-copilot-sidebar">
                <div class="chat-container">
                    <div class="chat-header">
                        <div class="chat-avatar">AI</div>
                        <div class="chat-title-group">
                            <span class="chat-title">Xobi Copilot</span>
                            <span class="chat-status">在线 · 正在为您服务</span>
                        </div>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="message ai">
                            <div class="message-bubble">
                                您好！上传表格后告诉我修改需求，确认后我来批量处理。
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-wrapper">
                        <div class="chat-input-toolbar">
                            <button class="tool-btn" title="上传参考图">📎</button>
                            <button class="tool-btn" title="灵感建议">💡</button>
                        </div>
                        <div class="chat-input-field">
                            <input type="text" id="chat-input" placeholder="向 AI Copilot 提问 or 下达指令..." disabled>
                            <button class="btn btn-primary btn-icon" id="chat-send-btn" onclick="sendChat()" disabled>
                                <span>⬆</span>
                            </button>
                        </div>
                        <div class="chat-hint" id="chat-hint">
                            💡 请先上传 Excel 表格，才能发送修改指令
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- 加载遮罩 -->
    <div id="loading-overlay"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
        <div style="text-align: center;">
            <div class="spinner"
                style="border: 3px solid rgba(255,255,255,0.1); border-top-color: var(--accent-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; margin: 0 auto 1rem;">
            </div>
            <div id="loading-text" style="color: var(--text-secondary);">Processing...</div>
        </div>
    </div>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 聊天提示样式 */
        .chat-hint {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            color: var(--text-tertiary);
            text-align: center;
        }
    </style>

    <!-- JS Scripts (v5) -->
    <script src="assets/js/api.js?v=5"></script>
    <script src="assets/js/main.js?v=5"></script>
    <script src="assets/js/batch.js?v=5"></script>
    <script src="assets/js/chat.js?v=5"></script>
    <script>
        // 初始化批量模式
        document.addEventListener('DOMContentLoaded', () => {
            initBatchMode();
            initChat();
        });
    </script>

</body>

</html>
